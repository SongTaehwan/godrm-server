frameworkVersion: '3'
configValidationMode: error

org: godrm
app: godrm
service: godrm-api

plugins:
  - serverless-offline
  - serverless-plugin-typescript 
  - serverless-domain-manager

provider:
  # General settings
  name: aws
  stage: ${sls:stage}
  region: ap-northeast-1

  deploymentMethod: direct
  # API Gateway settings
  apiName: ${self:service}-${sls:stage}

  # Function settings
  runtime: nodejs14.x
  timeout: 10 # default: 6s

  environment:
    DATABASE_URI: ${param:DATABASE_URI}

custom:
  domain:
    dev: godrm-dev.api-server.link
    prod: godrm.api-server.link
  customDomain:
    domainName: ${self:custom.domain.${opt:stage, 'dev'}}
    basePath: ''
    stage: ${self:provider.stage}
    createRoute53Record: true

functions:
  user:
    handler: apps/user/src/main.handler
    events:
      - http:
          method: ANY
          path: '/user'
      - http:
          method: ANY
          path: '/user/{proxy+}'
  food:
    handler: apps/food/src/main.handler
    events:
      - http:
          method: ANY
          path: /food
      - http:
          method: ANY
          path: '/food/{proxy+}'
  category:
    handler: apps/category/src/main.handler
    events:
      - http:
          method: ANY
          path: '/category'
      - http:
          method: ANY
          path: '/category/{proxy+}'
  favourite:
    handler: apps/favourite/src/main.handler
    events:
      - http:
          method: ANY
          path: '/favourite'
      - http:
          method: ANY
          path: '/favourite/{proxy+}'
  shopping-cart:
    handler: apps/shopping-cart/src/main.handler
    events:
      - http:
          method: ANY
          path: '/cart'
      - http:
          method: ANY
          path: '/cart/{proxy+}'